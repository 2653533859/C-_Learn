# C 语言基础语法详解指南

## 目录
- [1. C 程序基本结构](#1-c-程序基本结构)
- [2. 数据类型](#2-数据类型)
- [3. 变量与常量](#3-变量与常量)
- [4. 运算符](#4-运算符)
- [5. 表达式](#5-表达式)
- [6. 控制流](#6-控制流)
- [7. 函数基础](#7-函数基础)
- [8. 输入输出](#8-输入输出)

---

## 1. C 程序基本结构

一个最简单的 C 程序包含以下部分：

```c
#include <stdio.h>    // 预处理指令：包含标准输入输出库

int main() {          // 主函数：程序入口
    printf("Hello, World!\n");  // 函数调用
    return 0;         // 返回值：0 表示成功
}
```

### 程序执行流程图

```
┌─────────────────┐
│  预处理阶段      │ 处理 #include, #define 等
└────────┬────────┘
         │
┌────────▼────────┐
│  编译阶段        │ 将 C 代码转换为汇编代码
└────────┬────────┘
         │
┌────────▼────────┐
│  汇编阶段        │ 将汇编代码转换为机器码
└────────┬────────┘
         │
┌────────▼────────┐
│  链接阶段        │ 链接库函数，生成可执行文件
└────────┬────────┘
         │
┌────────▼────────┐
│  执行程序        │
└─────────────────┘
```

---

## 2. 数据类型

C 语言的数据类型分为基本类型和派生类型。

### 2.1 基本数据类型

| 类型 | 关键字 | 字节数(典型) | 取值范围(典型) | 用途 |
|------|--------|--------------|----------------|------|
| 字符型 | `char` | 1 | -128 ~ 127 或 0 ~ 255 | 存储单个字符或小整数 |
| 短整型 | `short` | 2 | -32,768 ~ 32,767 | 较小的整数 |
| 整型 | `int` | 4 | -2,147,483,648 ~ 2,147,483,647 | 常规整数运算 |
| 长整型 | `long` | 4/8 | 依平台而定 | 大整数 |
| 长长整型 | `long long` | 8 | -(2^63) ~ (2^63-1) | 超大整数 |
| 单精度浮点 | `float` | 4 | ±3.4E-38 ~ ±3.4E+38 | 小数运算（精度约7位） |
| 双精度浮点 | `double` | 8 | ±1.7E-308 ~ ±1.7E+308 | 高精度小数（精度约15位） |
| 长双精度 | `long double` | 10/16 | 更高精度 | 科学计算 |

### 2.2 类型修饰符

- **`signed`**（有符号）：可表示正负数，默认
- **`unsigned`**（无符号）：只能表示非负数，范围扩大一倍
- **示例**：`unsigned int` 范围为 0 ~ 4,294,967,295

### 2.3 sizeof 运算符

用于获取类型或变量占用的字节数：

```c
printf("int 占用 %lu 字节\n", sizeof(int));
printf("double 占用 %lu 字节\n", sizeof(double));
```

### 2.4 类型转换

#### 隐式转换（自动类型提升）

```c
int a = 10;
double b = 3.5;
double result = a + b;  // a 自动转换为 double
```

**转换规则**：
```
char → short → int → long → long long → float → double → long double
```

#### 显式转换（强制类型转换）

```c
double pi = 3.14159;
int truncated = (int)pi;  // 结果为 3，小数部分被截断
```

---

## 3. 变量与常量

### 3.1 变量

#### 变量声明与初始化

```c
int age;              // 声明（未初始化，值不确定）
int count = 0;        // 声明并初始化
float pi = 3.14f;     // f 后缀表示 float 类型
double e = 2.71828;   // 默认浮点数为 double
char grade = 'A';     // 单引号表示字符
```

#### 变量命名规则

✅ **合法**：
- 字母、数字、下划线组成
- 必须以字母或下划线开头
- 区分大小写
- 示例：`student_age`, `_temp`, `count1`

❌ **非法**：
- 不能以数字开头：`2count`
- 不能使用关键字：`int`, `return`, `if`
- 不能包含特殊字符：`my-var`, `user@name`

#### 变量作用域

| 作用域类型 | 声明位置 | 生命周期 | 示例 |
|-----------|----------|----------|------|
| 局部变量 | 函数内部或代码块内 | 代码块结束时销毁 | `int x = 5;` |
| 全局变量 | 所有函数外部 | 程序运行期间一直存在 | 函数外声明 |
| 静态局部变量 | 函数内用 `static` 声明 | 程序运行期间保持值 | `static int count = 0;` |

### 3.2 常量

#### 字面常量

```c
100         // 整型常量
3.14        // 浮点常量
'A'         // 字符常量
"Hello"     // 字符串常量
```

#### 符号常量（#define）

```c
#define PI 3.14159
#define MAX_SIZE 100

// 使用
double area = PI * r * r;
int arr[MAX_SIZE];
```

#### const 常量

```c
const int MAX_STUDENTS = 50;
const double TAX_RATE = 0.08;

// 尝试修改会导致编译错误
// MAX_STUDENTS = 60;  ❌ 错误！
```

**`#define` vs `const` 对比**：

| 特性 | #define | const |
|------|---------|-------|
| 类型检查 | 无 | 有 |
| 作用域 | 全局（宏替换） | 遵循作用域规则 |
| 调试 | 困难（预处理后替换） | 容易（有符号信息） |
| 内存占用 | 无 | 占用内存空间 |

---

## 4. 运算符

### 4.1 算术运算符

| 运算符 | 说明 | 示例 | 结果 |
|--------|------|------|------|
| `+` | 加法 | `5 + 3` | `8` |
| `-` | 减法 | `5 - 3` | `2` |
| `*` | 乘法 | `5 * 3` | `15` |
| `/` | 除法 | `5 / 2` | `2`（整数除法） |
| `/` | 除法 | `5.0 / 2` | `2.5`（浮点除法） |
| `%` | 取模（求余） | `5 % 2` | `1` |
| `++` | 自增 | `i++` 或 `++i` | 增加1 |
| `--` | 自减 | `i--` 或 `--i` | 减少1 |

**前缀与后缀区别**：

```c
int a = 5;
int b = a++;  // b = 5, a = 6 (先赋值后自增)
int c = ++a;  // c = 7, a = 7 (先自增后赋值)
```

### 4.2 关系运算符

| 运算符 | 说明 | 示例 | 结果 |
|--------|------|------|------|
| `==` | 等于 | `5 == 5` | `1`（真） |
| `!=` | 不等于 | `5 != 3` | `1`（真） |
| `>` | 大于 | `5 > 3` | `1`（真） |
| `<` | 小于 | `5 < 3` | `0`（假） |
| `>=` | 大于等于 | `5 >= 5` | `1`（真） |
| `<=` | 小于等于 | `5 <= 3` | `0`（假） |

**注意**：C 语言中 `0` 表示假，非零值表示真。

### 4.3 逻辑运算符

| 运算符 | 说明 | 示例 | 说明 |
|--------|------|------|------|
| `&&` | 逻辑与（AND） | `a && b` | 两者都为真时为真 |
| `||` | 逻辑或（OR） | `a || b` | 至少一个为真时为真 |
| `!` | 逻辑非（NOT） | `!a` | 真变假，假变真 |

**短路求值**：

```c
int x = 0;
if (x != 0 && 10 / x > 1) {  // x != 0 为假，不会执行后面的除法
    // 避免了除零错误
}
```

### 4.4 位运算符

| 运算符 | 说明 | 示例 | 用途 |
|--------|------|------|------|
| `&` | 按位与 | `a & b` | 权限判断、掩码操作 |
| `|` | 按位或 | `a | b` | 设置标志位 |
| `^` | 按位异或 | `a ^ b` | 简单加密、交换变量 |
| `~` | 按位取反 | `~a` | 求反码 |
| `<<` | 左移 | `a << 2` | 相当于乘以 2^2 |
| `>>` | 右移 | `a >> 2` | 相当于除以 2^2 |

**示例：权限系统**

```c
#define READ    0x01  // 0001
#define WRITE   0x02  // 0010
#define EXECUTE 0x04  // 0100

int permission = READ | WRITE;  // 0011 (可读可写)

if (permission & READ) {
    printf("有读权限\n");
}
```

### 4.5 赋值运算符

| 运算符 | 等价形式 | 示例 |
|--------|----------|------|
| `=` | - | `a = 5` |
| `+=` | `a = a + b` | `a += 5` |
| `-=` | `a = a - b` | `a -= 3` |
| `*=` | `a = a * b` | `a *= 2` |
| `/=` | `a = a / b` | `a /= 4` |
| `%=` | `a = a % b` | `a %= 3` |
| `&=` | `a = a & b` | `a &= 0xFF` |
| `|=` | `a = a | b` | `a |= 0x10` |

### 4.6 其他运算符

| 运算符 | 说明 | 示例 |
|--------|------|------|
| `sizeof` | 获取类型或变量大小 | `sizeof(int)` |
| `?:` | 三目运算符（条件运算符） | `max = (a > b) ? a : b` |
| `,` | 逗号运算符 | `a = (b = 3, b + 2)` → `a = 5` |
| `&` | 取地址 | `&variable` |
| `*` | 解引用（指针） | `*pointer` |

### 4.7 运算符优先级（从高到低）

| 优先级 | 运算符 | 结合性 |
|--------|--------|--------|
| 1 | `()` `[]` `->` `.` | 左→右 |
| 2 | `!` `~` `++` `--` `+` `-` `*` `&` `sizeof` | 右→左 |
| 3 | `*` `/` `%` | 左→右 |
| 4 | `+` `-` | 左→右 |
| 5 | `<<` `>>` | 左→右 |
| 6 | `<` `<=` `>` `>=` | 左→右 |
| 7 | `==` `!=` | 左→右 |
| 8 | `&` | 左→右 |
| 9 | `^` | 左→右 |
| 10 | `|` | 左→右 |
| 11 | `&&` | 左→右 |
| 12 | `||` | 左→右 |
| 13 | `?:` | 右→左 |
| 14 | `=` `+=` `-=` `*=` `/=` 等 | 右→左 |
| 15 | `,` | 左→右 |

**建议**：复杂表达式使用括号明确优先级，提高可读性。

---

## 5. 表达式

表达式是由操作数（变量、常量）和运算符组成的计算式。

### 5.1 表达式类型

```c
// 算术表达式
int result = (a + b) * c - d / 2;

// 关系表达式
int is_adult = age >= 18;  // 结果为 1 或 0

// 逻辑表达式
int valid = (age > 0) && (age < 120);

// 赋值表达式
int x = y = z = 10;  // 连续赋值，x, y, z 都为 10

// 混合表达式
double avg = (score1 + score2 + score3) / 3.0;
```

### 5.2 表达式求值顺序

```c
int a = 5;
int b = (a++) + (a++);  // 未定义行为！编译器可能有不同结果

// 建议改写为：
int b = a + (a + 1);
a += 2;
```

**警告**：不要在同一个表达式中多次修改同一变量。

---

## 6. 控制流

### 6.1 顺序结构

默认执行模式，从上到下逐行执行。

```c
int a = 10;
int b = 20;
int sum = a + b;
printf("Sum: %d\n", sum);
```

### 6.2 选择结构

#### if 语句

```c
if (条件) {
    // 条件为真时执行
}
```

```
    ┌───────────┐
    │  条件判断  │
    └─────┬─────┘
          │
      是  │  否
    ┌─────▼─────┐
    │ 执行语句块 │
    └───────────┘
```

#### if-else 语句

```c
if (score >= 60) {
    printf("及格\n");
} else {
    printf("不及格\n");
}
```

#### if-else if-else 语句

```c
if (score >= 90) {
    printf("优秀\n");
} else if (score >= 80) {
    printf("良好\n");
} else if (score >= 60) {
    printf("及格\n");
} else {
    printf("不及格\n");
}
```

#### switch 语句

```c
switch (表达式) {
    case 常量1:
        语句块1;
        break;
    case 常量2:
        语句块2;
        break;
    default:
        默认语句块;
}
```

**示例：星期判断**

```c
int day = 3;
switch (day) {
    case 1:
        printf("星期一\n");
        break;
    case 2:
        printf("星期二\n");
        break;
    case 3:
        printf("星期三\n");
        break;
    default:
        printf("无效日期\n");
}
```

**注意**：不加 `break` 会发生"贯穿"（fall-through）。

### 6.3 循环结构

#### while 循环

```c
while (条件) {
    // 循环体
}
```

```
    ┌───────────┐
 ┌─→│  条件判断  │─→ 否 ─→ 退出循环
 │  └─────┬─────┘
 │        │ 是
 │  ┌─────▼─────┐
 │  │ 执行循环体 │
 │  └───────────┘
 └────────┘
```

**示例**：

```c
int i = 1, sum = 0;
while (i <= 10) {
    sum += i;
    i++;
}
printf("1到10的和为: %d\n", sum);
```

#### do-while 循环

```c
do {
    // 循环体（至少执行一次）
} while (条件);
```

**与 while 的区别**：先执行一次循环体再判断条件。

```c
int password;
do {
    printf("请输入密码: ");
    scanf("%d", &password);
} while (password != 1234);
```

#### for 循环

```c
for (初始化; 条件; 更新) {
    // 循环体
}
```

**示例**：

```c
for (int i = 0; i < 10; i++) {
    printf("%d ", i);
}
```

**等价的 while 循环**：

```c
int i = 0;
while (i < 10) {
    printf("%d ", i);
    i++;
}
```

#### 循环控制语句

| 语句 | 作用 | 示例 |
|------|------|------|
| `break` | 立即退出循环 | 找到目标后提前结束 |
| `continue` | 跳过本次迭代，进入下次循环 | 跳过偶数 |

**示例**：

```c
// break
for (int i = 0; i < 10; i++) {
    if (i == 5) break;  // 遇到 5 就退出
    printf("%d ", i);   // 输出: 0 1 2 3 4
}

// continue
for (int i = 0; i < 10; i++) {
    if (i % 2 == 0) continue;  // 跳过偶数
    printf("%d ", i);          // 输出: 1 3 5 7 9
}
```

#### 嵌套循环

```c
// 打印九九乘法表
for (int i = 1; i <= 9; i++) {
    for (int j = 1; j <= i; j++) {
        printf("%d*%d=%d ", j, i, i * j);
    }
    printf("\n");
}
```

---

## 7. 函数基础

### 7.1 函数的定义

```c
返回类型 函数名(参数列表) {
    // 函数体
    return 返回值;
}
```

**示例**：

```c
int add(int a, int b) {
    return a + b;
}
```

### 7.2 函数的声明与调用

```c
// 函数声明（原型）
int add(int a, int b);

int main() {
    int result = add(5, 3);  // 函数调用
    printf("Result: %d\n", result);
    return 0;
}

// 函数定义
int add(int a, int b) {
    return a + b;
}
```

### 7.3 函数参数传递

#### 值传递

C 语言默认按值传递：函数内修改参数不影响实参。

```c
void increment(int x) {
    x++;  // 只修改副本
}

int main() {
    int a = 5;
    increment(a);
    printf("%d\n", a);  // 输出: 5（未改变）
    return 0;
}
```

#### 引用传递（通过指针）

```c
void increment(int *x) {
    (*x)++;  // 修改指针指向的值
}

int main() {
    int a = 5;
    increment(&a);
    printf("%d\n", a);  // 输出: 6（已改变）
    return 0;
}
```

### 7.4 函数返回值

- **有返回值**：必须用 `return` 返回对应类型的值
- **无返回值**：使用 `void` 类型

```c
void greet(char *name) {
    printf("Hello, %s!\n", name);
    // 不需要 return
}

int max(int a, int b) {
    return (a > b) ? a : b;  // 必须返回 int
}
```

### 7.5 函数调用流程图

```
┌──────────────┐
│  主函数调用   │
│  result = add(5, 3)
└──────┬───────┘
       │
┌──────▼───────┐
│  保存现场     │ 保存 main 的状态
└──────┬───────┘
       │
┌──────▼───────┐
│  传递参数     │ a = 5, b = 3
└──────┬───────┘
       │
┌──────▼───────┐
│  执行函数体   │ return a + b
└──────┬───────┘
       │
┌──────▼───────┐
│  返回结果     │ 8
└──────┬───────┘
       │
┌──────▼───────┐
│  恢复现场     │ 回到 main
│  result = 8  │
└──────────────┘
```

### 7.6 递归函数

函数调用自身。

```c
int factorial(int n) {
    if (n <= 1) {
        return 1;  // 基准情况
    }
    return n * factorial(n - 1);  // 递归调用
}

// factorial(5) = 5 * factorial(4)
//              = 5 * 4 * factorial(3)
//              = 5 * 4 * 3 * factorial(2)
//              = 5 * 4 * 3 * 2 * factorial(1)
//              = 5 * 4 * 3 * 2 * 1 = 120
```

---

## 8. 输入输出

### 8.1 标准输出 printf

```c
printf("格式化字符串", 参数列表);
```

#### 格式说明符

| 说明符 | 类型 | 示例 | 输出 |
|--------|------|------|------|
| `%d` | int | `printf("%d", 42)` | `42` |
| `%u` | unsigned int | `printf("%u", 42)` | `42` |
| `%f` | float/double | `printf("%f", 3.14)` | `3.140000` |
| `%.2f` | 保留2位小数 | `printf("%.2f", 3.14)` | `3.14` |
| `%c` | char | `printf("%c", 'A')` | `A` |
| `%s` | 字符串 | `printf("%s", "Hello")` | `Hello` |
| `%p` | 指针地址 | `printf("%p", &var)` | `0x7ffd...` |
| `%x` | 十六进制 | `printf("%x", 255)` | `ff` |
| `%o` | 八进制 | `printf("%o", 8)` | `10` |
| `%%` | 输出 % | `printf("100%%")` | `100%` |

#### 格式控制

```c
printf("%5d\n", 42);      // "   42" (右对齐，宽度5)
printf("%-5d\n", 42);     // "42   " (左对齐，宽度5)
printf("%08d\n", 42);     // "00000042" (用0填充)
printf("%+d\n", 42);      // "+42" (显示符号)
```

### 8.2 标准输入 scanf

```c
scanf("格式化字符串", 变量地址列表);
```

**示例**：

```c
int age;
float height;
char grade;

scanf("%d", &age);           // 读取整数
scanf("%f", &height);        // 读取浮点数
scanf(" %c", &grade);        // 读取字符（注意空格）

// 同时读取多个值
scanf("%d %f %c", &age, &height, &grade);
```

**注意事项**：

1. 必须使用 `&` 取地址符（数组除外）
2. 读取字符前加空格跳过空白符：`" %c"`
3. 返回值为成功读取的项数：

```c
int ret = scanf("%d", &num);
if (ret != 1) {
    printf("输入错误\n");
}
```

### 8.3 字符输入输出

```c
int getchar(void);       // 读取一个字符
int putchar(int c);      // 输出一个字符

// 示例
char ch = getchar();
putchar(ch);
```

### 8.4 gets 和 puts（不推荐 gets）

```c
char str[100];

// ❌ 不安全：gets 不检查缓冲区大小
gets(str);

// ✅ 推荐：fgets 限制读取长度
fgets(str, sizeof(str), stdin);

// 输出字符串
puts(str);  // 自动添加换行符
```

---

## 总结与最佳实践

### ✅ 编码规范建议

1. **命名规范**：使用有意义的变量名（`student_count` 而非 `sc`）
2. **缩进对齐**：使用 4 空格或 1 Tab，保持一致
3. **注释清晰**：关键逻辑添加注释，但避免过度注释
4. **常量优先**：魔法数字（如 `100`）应定义为常量
5. **错误检查**：对 `scanf`、文件操作等进行返回值检查

### ❌ 常见错误

1. **未初始化变量**：
   ```c
   int x;
   printf("%d", x);  // 未定义行为
   ```

2. **整数除法陷阱**：
   ```c
   int a = 5, b = 2;
   float result = a / b;  // 结果为 2.0（整数除法）
   // 正确: float result = (float)a / b;
   ```

3. **赋值与比较混淆**：
   ```c
   if (x = 5) { ... }  // 错误：应为 x == 5
   ```

4. **数组越界**：
   ```c
   int arr[5];
   arr[5] = 10;  // 错误：索引范围是 0-4
   ```

5. **scanf 后的换行符问题**：
   ```c
   scanf("%d", &num);
   getchar();  // 读取残留的换行符
   scanf("%c", &ch);
   ```

### 📚 学习建议

1. **动手实践**：每个知识点都编写小程序验证
2. **调试技巧**：使用 `printf` 输出中间值或学习 GDB
3. **循序渐进**：先掌握基础语法，再学习复杂数据结构
4. **代码复盘**：写完代码后思考是否有优化空间
5. **参考标准**：遵循 C99 或 C11 标准

---

## 下一步学习

完成本模块后，你应该能够：
- ✅ 编写包含变量、运算符、控制流的完整 C 程序
- ✅ 理解不同数据类型的适用场景
- ✅ 熟练使用条件语句和循环结构
- ✅ 定义和调用简单函数
- ✅ 进行基本的输入输出操作

继续学习 **[02_控制结构](../02_控制结构/README.md)** 模块，深入掌握复杂的流程控制技巧。
